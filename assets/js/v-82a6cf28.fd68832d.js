"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[958],{6665:(n,s,a)=>{a.r(s),a.d(s,{data:()=>p});const p={key:"v-82a6cf28",path:"/front-end/javascript/27_cookie.html",title:"Cookie",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"基本使用",slug:"基本使用",children:[]},{level:2,title:"cookie 的常見屬性",slug:"cookie-的常見屬性",children:[{level:3,title:"cookie 的生命週期",slug:"cookie-的生命週期",children:[]},{level:3,title:"cookie 的作用域",slug:"cookie-的作用域",children:[]}]},{level:2,title:"瀏覽器中操作 cookie",slug:"瀏覽器中操作-cookie",children:[]},{level:2,title:"cookie 的缺點",slug:"cookie-的缺點",children:[]}],filePathRelative:"front-end/javascript/27_cookie.md",git:{updatedTime:1665400196e3,contributors:[{name:"louis61619",email:"louis61619@gmail.com",commits:1}]}}},3674:(n,s,a)=>{a.r(s),a.d(s,{default:()=>w});var p=a(6252);const t=(0,p._)("h1",{id:"cookie",tabindex:"-1"},[(0,p._)("a",{class:"header-anchor",href:"#cookie","aria-hidden":"true"},"#"),(0,p.Uk)(" Cookie")],-1),e=(0,p._)("p",null,"Cookie，類型為小型文件文件，某些網站為了識別用戶申份而儲存在用戶本地終端（Client Side）上的數據，瀏覽器會在特定情況下攜帶 cookie 發送請求，服務器可以通過 cookie 來獲取一些信息。",-1),o=(0,p._)("p",null,"Cookie 儲存在客戶端中，按在客戶端中的儲存位置，可分為記憶體 Cookie 和硬碟 Cookie。",-1),c=(0,p.Uk)("記憶體 Cookie 由"),l={href:"https://zh.wikipedia.org/wiki/%E6%B5%8F%E8%A7%88%E5%99%A8",target:"_blank",rel:"noopener noreferrer"},i=(0,p.Uk)("瀏覽器"),u=(0,p.Uk)("維護，儲存在"),k={href:"https://zh.wikipedia.org/wiki/%E5%86%85%E5%AD%98",target:"_blank",rel:"noopener noreferrer"},r=(0,p.Uk)("記憶體"),b=(0,p.Uk)("中，瀏覽器關閉即消失，存在時間短暫。硬碟 Cookie 儲存在"),d={href:"https://zh.wikipedia.org/wiki/%E7%A1%AC%E7%9B%98",target:"_blank",rel:"noopener noreferrer"},m=(0,p.Uk)("硬碟"),g=(0,p.Uk)("裡，有過期時間，除非使用者手動清理或到了過期時間，硬碟 Cookie 不會清除，存在時間較長。所以，按存在時間，可分為非持久 Cookie 和持久 Cookie。"),h=(0,p.uE)('<h2 id="基本使用" tabindex="-1"><a class="header-anchor" href="#基本使用" aria-hidden="true">#</a> 基本使用</h2><p>透過 express 這個 web 框架可以輕鬆的管理 cookie：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 首頁，讀取cookie</span>\napp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/home&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>cookie\n    <span class="token operator">?</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> data <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;=&#39;</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>res<span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, you&#39;re age is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 登入，註冊cookie</span>\napp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 建立cookie，值為字串</span>\n  res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Louis&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> expires<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">900000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> httpOnly<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;26&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> expires<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">900000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> httpOnly<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;已註冊cookie&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 退出，清除cookie</span>\napp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/exit&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  res<span class="token punctuation">.</span><span class="token function">clearCookie</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span>\n  res<span class="token punctuation">.</span><span class="token function">clearCookie</span><span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">)</span>\n  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;已清除cookie&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\napp<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="cookie-的常見屬性" tabindex="-1"><a class="header-anchor" href="#cookie-的常見屬性" aria-hidden="true">#</a> cookie 的常見屬性</h2><h3 id="cookie-的生命週期" tabindex="-1"><a class="header-anchor" href="#cookie-的生命週期" aria-hidden="true">#</a> cookie 的生命週期</h3><p>默認情況下 cookie 是記憶體 Cookie，也就是在瀏覽器關閉時會自動被刪除，可以透過參數 expires 或 max-age 來設置過期時間：</p><ul><li>expires：設置的事 Date.toUTCString，設置格式是 ;expires=date-in-GMTString-formate；</li><li>max-age：設置過期秒鐘 ;max-age=max-age-in-secondes （例如一年為 <code>60*60*24*365</code>）</li></ul><h3 id="cookie-的作用域" tabindex="-1"><a class="header-anchor" href="#cookie-的作用域" aria-hidden="true">#</a> cookie 的作用域</h3><ul><li><p>如果不指定 domain，默認為 origin，不包含子域名，如果指定 domain 則包含子域名。如果設置 Domain=mozila.org，則 cookie 也包含在子域名中（如：developer.mozila.org）。</p></li><li><p>如果不指定 path，默認為所有路徑。如果設置 Path=/docs，則會匹配所有 /docs 下的路徑，如：/docs、/docs/web、/docs/web/123</p></li></ul><h2 id="瀏覽器中操作-cookie" tabindex="-1"><a class="header-anchor" href="#瀏覽器中操作-cookie" aria-hidden="true">#</a> 瀏覽器中操作 cookie</h2><p>在 cookie 中有一個屬性為 httpOnly，當其為 true 時便不可以透過 JavaScript 進行操作，所以要設置為 false。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\napp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Louis&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> expires<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">900000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> httpOnly<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;已註冊cookie&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\napp<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>要將 cookie 刪除必須對 max-age 進行設置：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&#39;name=louis;max-age=0&#39;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="cookie-的缺點" tabindex="-1"><a class="header-anchor" href="#cookie-的缺點" aria-hidden="true">#</a> cookie 的缺點</h2><ul><li>cookie 會附加在每一次請求頭中，無形中增加了流量</li><li>cookie 在 headers 中是被明文傳輸的</li><li>大小限制只有 4kb</li></ul>',16),f={},w=(0,a(3744).Z)(f,[["render",function(n,s){const a=(0,p.up)("OutboundLink");return(0,p.wg)(),(0,p.iD)(p.HY,null,[t,e,o,(0,p._)("p",null,[c,(0,p._)("a",l,[i,(0,p.Wm)(a)]),u,(0,p._)("a",k,[r,(0,p.Wm)(a)]),b,(0,p._)("a",d,[m,(0,p.Wm)(a)]),g]),h],64)}]])}}]);